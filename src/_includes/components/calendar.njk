{# Calendar component for displaying events #}
{# Mobile: Date-grouped list | Desktop: Calendar grid + list #}

{# Current date for filtering future events #}
{% set today = "2026-01-16" %}

{# Get events with dates (exclude recurring events) #}
{% set datedEvents = [] %}
{% for event in events.items %}
  {% if event.date and event.date | trim and event.active and event.date >= today %}
    {% set datedEvents = (datedEvents.push(event), datedEvents) %}
  {% endif %}
{% endfor %}

{# Get recurring events #}
{% set recurringEvents = [] %}
{% for event in events.items %}
  {% if event.active and event.recurring_pattern and event.recurring_pattern | trim %}
    {% if not event.date or not (event.date | trim) %}
      {% set recurringEvents = (recurringEvents.push(event), recurringEvents) %}
    {% endif %}
  {% endif %}
{% endfor %}

{# Create single set for all event dates (both recurring and specific) #}
{% set eventDates = [] %}

{# Add specific dated events #}
{% for event in datedEvents %}
  {% if event.date not in eventDates %}
    {% set eventDates = (eventDates.push(event.date), eventDates) %}
  {% endif %}
{% endfor %}

{# Add dates for recurring events based on pattern #}
{# January 2026: Thu Jan 1 - Sat Jan 31 #}
{# Week starts Thu 1/1, then Sun 1/5 - Sat 1/11, etc. #}
{% for recurring in recurringEvents %}
  {% set pattern = recurring.recurring_pattern | lower %}
  
  {# Check for ordinal patterns first (1st, 2nd, 3rd, 4th, 5th) #}
  {# January 2026 day-of-week schedule (Jan 1 = Thursday):
     Mon: 5, 12, 19, 26
     Tue: 6, 13, 20, 27
     Wed: 7, 14, 21, 28
     Thu: 1, 8, 15, 22, 29
     Fri: 2, 9, 16, 23, 30
     Sat: 3, 10, 17, 24, 31
     Sun: 4, 11, 18, 25
  #}
  
  {% if ("1st" in pattern or "first" in pattern) and "monday" in pattern %}
    {% if "2026-01-05" >= today %}
      {% if "2026-01-05" >= today %}
      {% set eventDates = (eventDates.push("2026-01-05"), eventDates) %}
    {% endif %}
    {% endif %}
  {% elif ("2nd" in pattern or "second" in pattern) and "monday" in pattern %}
    {% if "2026-01-12" >= today %}
      {% if "2026-01-12" >= today %}
      {% set eventDates = (eventDates.push("2026-01-12"), eventDates) %}
    {% endif %}
    {% endif %}
  {% elif ("3rd" in pattern or "third" in pattern) and "monday" in pattern %}
    {% if "2026-01-19" >= today %}
      {% if "2026-01-19" >= today %}
      {% set eventDates = (eventDates.push("2026-01-19"), eventDates) %}
    {% endif %}
    {% endif %}
  {% elif ("4th" in pattern or "fourth" in pattern) and "monday" in pattern %}
    {% if "2026-01-26" >= today %}
      {% if "2026-01-26" >= today %}
      {% set eventDates = (eventDates.push("2026-01-26"), eventDates) %}
    {% endif %}
    {% endif %}
  
  {% elif ("1st" in pattern or "first" in pattern) and "tuesday" in pattern %}
    {% if "2026-01-06" >= today %}
      {% set eventDates = (eventDates.push("2026-01-06"), eventDates) %}
    {% endif %}
  {% elif ("2nd" in pattern or "second" in pattern) and "tuesday" in pattern %}
    {% if "2026-01-13" >= today %}
      {% set eventDates = (eventDates.push("2026-01-13"), eventDates) %}
    {% endif %}
  {% elif ("3rd" in pattern or "third" in pattern) and "tuesday" in pattern %}
    {% if "2026-01-20" >= today %}
      {% set eventDates = (eventDates.push("2026-01-20"), eventDates) %}
    {% endif %}
  {% elif ("4th" in pattern or "fourth" in pattern) and "tuesday" in pattern %}
    {% if "2026-01-27" >= today %}
      {% set eventDates = (eventDates.push("2026-01-27"), eventDates) %}
    {% endif %}
  
  {% elif ("1st" in pattern or "first" in pattern) and "wednesday" in pattern %}
    {% if "2026-01-07" >= today %}
      {% set eventDates = (eventDates.push("2026-01-07"), eventDates) %}
    {% endif %}
  {% elif ("2nd" in pattern or "second" in pattern) and "wednesday" in pattern %}
    {% if "2026-01-14" >= today %}
      {% set eventDates = (eventDates.push("2026-01-14"), eventDates) %}
    {% endif %}
  {% elif ("3rd" in pattern or "third" in pattern) and "wednesday" in pattern %}
    {% if "2026-01-21" >= today %}
      {% set eventDates = (eventDates.push("2026-01-21"), eventDates) %}
    {% endif %}
  {% elif ("4th" in pattern or "fourth" in pattern) and "wednesday" in pattern %}
    {% if "2026-01-28" >= today %}
      {% set eventDates = (eventDates.push("2026-01-28"), eventDates) %}
    {% endif %}
  
  {% elif ("1st" in pattern or "first" in pattern) and "thursday" in pattern %}
    {% if "2026-01-01" >= today %}
      {% set eventDates = (eventDates.push("2026-01-01"), eventDates) %}
    {% endif %}
  {% elif ("2nd" in pattern or "second" in pattern) and "thursday" in pattern %}
    {% if "2026-01-08" >= today %}
      {% set eventDates = (eventDates.push("2026-01-08"), eventDates) %}
    {% endif %}
  {% elif ("3rd" in pattern or "third" in pattern) and "thursday" in pattern %}
    {% if "2026-01-15" >= today %}
      {% set eventDates = (eventDates.push("2026-01-15"), eventDates) %}
    {% endif %}
  {% elif ("4th" in pattern or "fourth" in pattern) and "thursday" in pattern %}
    {% if "2026-01-22" >= today %}
      {% set eventDates = (eventDates.push("2026-01-22"), eventDates) %}
    {% endif %}
  {% elif ("5th" in pattern or "fifth" in pattern) and "thursday" in pattern %}
    {% if "2026-01-29" >= today %}
      {% set eventDates = (eventDates.push("2026-01-29"), eventDates) %}
    {% endif %}
  
  {% elif ("1st" in pattern or "first" in pattern) and "friday" in pattern %}
    {% if "2026-01-02" >= today %}
      {% set eventDates = (eventDates.push("2026-01-02"), eventDates) %}
    {% endif %}
  {% elif ("2nd" in pattern or "second" in pattern) and "friday" in pattern %}
    {% if "2026-01-09" >= today %}
      {% set eventDates = (eventDates.push("2026-01-09"), eventDates) %}
    {% endif %}
  {% elif ("3rd" in pattern or "third" in pattern) and "friday" in pattern %}
    {% if "2026-01-16" >= today %}
      {% set eventDates = (eventDates.push("2026-01-16"), eventDates) %}
    {% endif %}
  {% elif ("4th" in pattern or "fourth" in pattern) and "friday" in pattern %}
    {% if "2026-01-23" >= today %}
      {% set eventDates = (eventDates.push("2026-01-23"), eventDates) %}
    {% endif %}
  {% elif ("5th" in pattern or "fifth" in pattern) and "friday" in pattern %}
    {% if "2026-01-30" >= today %}
      {% set eventDates = (eventDates.push("2026-01-30"), eventDates) %}
    {% endif %}
  
  {% elif ("1st" in pattern or "first" in pattern) and "saturday" in pattern %}
    {% if "2026-01-03" >= today %}
      {% set eventDates = (eventDates.push("2026-01-03"), eventDates) %}
    {% endif %}
  {% elif ("2nd" in pattern or "second" in pattern) and "saturday" in pattern %}
    {% if "2026-01-10" >= today %}
      {% set eventDates = (eventDates.push("2026-01-10"), eventDates) %}
    {% endif %}
  {% elif ("3rd" in pattern or "third" in pattern) and "saturday" in pattern %}
    {% if "2026-01-17" >= today %}
      {% set eventDates = (eventDates.push("2026-01-17"), eventDates) %}
    {% endif %}
  {% elif ("4th" in pattern or "fourth" in pattern) and "saturday" in pattern %}
    {% if "2026-01-24" >= today %}
      {% set eventDates = (eventDates.push("2026-01-24"), eventDates) %}
    {% endif %}
  {% elif ("5th" in pattern or "fifth" in pattern) and "saturday" in pattern %}
    {% if "2026-01-31" >= today %}
      {% set eventDates = (eventDates.push("2026-01-31"), eventDates) %}
    {% endif %}
  
  {% elif ("1st" in pattern or "first" in pattern) and "sunday" in pattern %}
    {% if "2026-01-04" >= today %}
      {% set eventDates = (eventDates.push("2026-01-04"), eventDates) %}
    {% endif %}
  {% elif ("2nd" in pattern or "second" in pattern) and "sunday" in pattern %}
    {% if "2026-01-11" >= today %}
      {% set eventDates = (eventDates.push("2026-01-11"), eventDates) %}
    {% endif %}
  {% elif ("3rd" in pattern or "third" in pattern) and "sunday" in pattern %}
    {% if "2026-01-18" >= today %}
      {% set eventDates = (eventDates.push("2026-01-18"), eventDates) %}
    {% endif %}
  {% elif ("4th" in pattern or "fourth" in pattern) and "sunday" in pattern %}
    {% if "2026-01-25" >= today %}
      {% set eventDates = (eventDates.push("2026-01-25"), eventDates) %}
    {% endif %}
  
  {# Check for "every [day]" patterns (only if no ordinal was matched) #}
  {% elif "monday" in pattern %}
    {% if "2026-01-05" >= today %}
      {% set eventDates = (eventDates.push("2026-01-05"), eventDates) %}
    {% endif %}
    {% if "2026-01-12" >= today %}
      {% set eventDates = (eventDates.push("2026-01-12"), eventDates) %}
    {% endif %}
    {% if "2026-01-19" >= today %}
      {% set eventDates = (eventDates.push("2026-01-19"), eventDates) %}
    {% endif %}
    {% if "2026-01-26" >= today %}
      {% set eventDates = (eventDates.push("2026-01-26"), eventDates) %}
    {% endif %}
  
  {% elif "tuesday" in pattern %}
    {% if "2026-01-06" >= today %}
      {% set eventDates = (eventDates.push("2026-01-06"), eventDates) %}
    {% endif %}
    {% if "2026-01-13" >= today %}
      {% set eventDates = (eventDates.push("2026-01-13"), eventDates) %}
    {% endif %}
    {% if "2026-01-20" >= today %}
      {% set eventDates = (eventDates.push("2026-01-20"), eventDates) %}
    {% endif %}
    {% if "2026-01-27" >= today %}
      {% set eventDates = (eventDates.push("2026-01-27"), eventDates) %}
    {% endif %}
  
  {% elif "wednesday" in pattern %}
    {% if "2026-01-07" >= today %}
      {% set eventDates = (eventDates.push("2026-01-07"), eventDates) %}
    {% endif %}
    {% if "2026-01-14" >= today %}
      {% set eventDates = (eventDates.push("2026-01-14"), eventDates) %}
    {% endif %}
    {% if "2026-01-21" >= today %}
      {% set eventDates = (eventDates.push("2026-01-21"), eventDates) %}
    {% endif %}
    {% if "2026-01-28" >= today %}
      {% set eventDates = (eventDates.push("2026-01-28"), eventDates) %}
    {% endif %}
  
  {% elif "thursday" in pattern %}
    {% if "2026-01-01" >= today %}
      {% set eventDates = (eventDates.push("2026-01-01"), eventDates) %}
    {% endif %}
    {% if "2026-01-08" >= today %}
      {% set eventDates = (eventDates.push("2026-01-08"), eventDates) %}
    {% endif %}
    {% if "2026-01-15" >= today %}
      {% set eventDates = (eventDates.push("2026-01-15"), eventDates) %}
    {% endif %}
    {% if "2026-01-22" >= today %}
      {% set eventDates = (eventDates.push("2026-01-22"), eventDates) %}
    {% endif %}
    {% if "2026-01-29" >= today %}
      {% set eventDates = (eventDates.push("2026-01-29"), eventDates) %}
    {% endif %}
  
  {% elif "friday" in pattern %}
    {% if "2026-01-02" >= today %}
      {% set eventDates = (eventDates.push("2026-01-02"), eventDates) %}
    {% endif %}
    {% if "2026-01-09" >= today %}
      {% set eventDates = (eventDates.push("2026-01-09"), eventDates) %}
    {% endif %}
    {% if "2026-01-16" >= today %}
      {% set eventDates = (eventDates.push("2026-01-16"), eventDates) %}
    {% endif %}
    {% if "2026-01-23" >= today %}
      {% set eventDates = (eventDates.push("2026-01-23"), eventDates) %}
    {% endif %}
    {% if "2026-01-30" >= today %}
      {% set eventDates = (eventDates.push("2026-01-30"), eventDates) %}
    {% endif %}
  
  {% elif "saturday" in pattern %}
    {% if "2026-01-03" >= today %}
      {% set eventDates = (eventDates.push("2026-01-03"), eventDates) %}
    {% endif %}
    {% if "2026-01-10" >= today %}
      {% set eventDates = (eventDates.push("2026-01-10"), eventDates) %}
    {% endif %}
    {% if "2026-01-17" >= today %}
      {% set eventDates = (eventDates.push("2026-01-17"), eventDates) %}
    {% endif %}
    {% if "2026-01-24" >= today %}
      {% set eventDates = (eventDates.push("2026-01-24"), eventDates) %}
    {% endif %}
    {% if "2026-01-31" >= today %}
      {% set eventDates = (eventDates.push("2026-01-31"), eventDates) %}
    {% endif %}
  
  {% elif "sunday" in pattern %}
    {% if "2026-01-04" >= today %}
      {% set eventDates = (eventDates.push("2026-01-04"), eventDates) %}
    {% endif %}
    {% if "2026-01-11" >= today %}
      {% set eventDates = (eventDates.push("2026-01-11"), eventDates) %}
    {% endif %}
    {% if "2026-01-18" >= today %}
      {% set eventDates = (eventDates.push("2026-01-18"), eventDates) %}
    {% endif %}
    {% if "2026-01-25" >= today %}
      {% set eventDates = (eventDates.push("2026-01-25"), eventDates) %}
    {% endif %}
  {% endif %}
{% endfor %}

{# Simple calendar grid - Desktop only #}
<div class="calendar-view">
  <div class="calendar-header">
    <h2 class="h4">January 2026</h2>
    <p class="text-white-50 small">Dates with events are highlighted. Click to view details below.</p>
  </div>
  
  <div class="calendar-grid">
    <table class="calendar-table" role="grid" aria-label="Events calendar">
      <thead>
        <tr>
          <th scope="col" abbr="Sunday">Sun</th>
          <th scope="col" abbr="Monday">Mon</th>
          <th scope="col" abbr="Tuesday">Tue</th>
          <th scope="col" abbr="Wednesday">Wed</th>
          <th scope="col" abbr="Thursday">Thu</th>
          <th scope="col" abbr="Friday">Fri</th>
          <th scope="col" abbr="Saturday">Sat</th>
        </tr>
      </thead>
      <tbody>
        {# January 2026 calendar grid - checking for events on each date #}
        <tr>
          <td class="empty"></td>
          <td class="empty"></td>
          <td class="empty"></td>
          <td class="empty"></td>
          <td class="calendar-day {% if '2026-01-01' in eventDates %}has-events{% elif '2026-01-01' in eventDates %}has-events{% endif %}">
            {% if '2026-01-01' in eventDates %}
              <a href="#date-2026-01-01" class="day-link"><span class="day-number">1</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">1</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-02' in eventDates %}has-events{% elif '2026-01-02' in eventDates %}has-events{% endif %}">
            {% if '2026-01-02' in eventDates %}
              <a href="#date-2026-01-02" class="day-link"><span class="day-number">2</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">2</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-03' in eventDates %}has-events{% elif '2026-01-03' in eventDates %}has-events{% endif %}">
            {% if '2026-01-03' in eventDates %}
              <a href="#date-2026-01-03" class="day-link"><span class="day-number">3</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">3</span></span>
            {% endif %}
          </td>
        </tr>
        <tr>
          <td class="calendar-day {% if '2026-01-04' in eventDates %}has-events{% endif %}">
            {% if '2026-01-04' in eventDates %}
              <a href="#date-2026-01-04" class="day-link"><span class="day-number">4</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">4</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-05' in eventDates %}has-events{% endif %}">
            {% if '2026-01-05' in eventDates %}
              <a href="#date-2026-01-05" class="day-link"><span class="day-number">5</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">5</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-06' in eventDates %}has-events{% endif %}">
            {% if '2026-01-06' in eventDates %}
              <a href="#date-2026-01-06" class="day-link"><span class="day-number">6</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">6</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-07' in eventDates %}has-events{% endif %}">
            {% if '2026-01-07' in eventDates %}
              <a href="#date-2026-01-07" class="day-link"><span class="day-number">7</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">7</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-08' in eventDates %}has-events{% endif %}">
            {% if '2026-01-08' in eventDates %}
              <a href="#date-2026-01-08" class="day-link"><span class="day-number">8</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">8</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-09' in eventDates %}has-events{% endif %}">
            {% if '2026-01-09' in eventDates %}
              <a href="#date-2026-01-09" class="day-link"><span class="day-number">9</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">9</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-10' in eventDates %}has-events{% endif %}">
            {% if '2026-01-10' in eventDates %}
              <a href="#date-2026-01-10" class="day-link"><span class="day-number">10</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">10</span></span>
            {% endif %}
          </td>
        </tr>
        <tr>
          <td class="calendar-day {% if '2026-01-11' in eventDates %}has-events{% endif %}">
            {% if '2026-01-11' in eventDates %}
              <a href="#date-2026-01-11" class="day-link"><span class="day-number">11</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">11</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-12' in eventDates %}has-events{% endif %}">
            {% if '2026-01-12' in eventDates %}
              <a href="#date-2026-01-12" class="day-link"><span class="day-number">12</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">12</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-13' in eventDates %}has-events{% endif %}">
            {% if '2026-01-13' in eventDates %}
              <a href="#date-2026-01-13" class="day-link"><span class="day-number">13</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">13</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-14' in eventDates %}has-events{% endif %}">
            {% if '2026-01-14' in eventDates %}
              <a href="#date-2026-01-14" class="day-link"><span class="day-number">14</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">14</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-15' in eventDates %}has-events{% endif %}">
            {% if '2026-01-15' in eventDates %}
              <a href="#date-2026-01-15" class="day-link"><span class="day-number">15</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">15</span></span>
            {% endif %}
          </td>
          <td class="calendar-day today {% if '2026-01-16' in eventDates %}has-events{% endif %}">
            {% if '2026-01-16' in eventDates %}
              <a href="#date-2026-01-16" class="day-link"><span class="day-number">16</span><span class="today-label">Today</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">16</span><span class="today-label">Today</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-17' in eventDates %}has-events{% endif %}">
            {% if '2026-01-17' in eventDates %}
              <a href="#date-2026-01-17" class="day-link"><span class="day-number">17</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">17</span></span>
            {% endif %}
          </td>
        </tr>
        <tr>
          <td class="calendar-day {% if '2026-01-18' in eventDates %}has-events{% endif %}">
            {% if '2026-01-18' in eventDates %}
              <a href="#date-2026-01-18" class="day-link"><span class="day-number">18</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">18</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-19' in eventDates %}has-events{% endif %}">
            {% if '2026-01-19' in eventDates %}
              <a href="#date-2026-01-19" class="day-link"><span class="day-number">19</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">19</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-20' in eventDates %}has-events{% endif %}">
            {% if '2026-01-20' in eventDates %}
              <a href="#date-2026-01-20" class="day-link"><span class="day-number">20</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">20</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-21' in eventDates %}has-events{% endif %}">
            {% if '2026-01-21' in eventDates %}
              <a href="#date-2026-01-21" class="day-link"><span class="day-number">21</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">21</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-22' in eventDates %}has-events{% endif %}">
            {% if '2026-01-22' in eventDates %}
              <a href="#date-2026-01-22" class="day-link"><span class="day-number">22</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">22</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-23' in eventDates %}has-events{% endif %}">
            {% if '2026-01-23' in eventDates %}
              <a href="#date-2026-01-23" class="day-link"><span class="day-number">23</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">23</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-24' in eventDates %}has-events{% endif %}">
            {% if '2026-01-24' in eventDates %}
              <a href="#date-2026-01-24" class="day-link"><span class="day-number">24</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">24</span></span>
            {% endif %}
          </td>
        </tr>
        <tr>
          <td class="calendar-day {% if '2026-01-25' in eventDates %}has-events{% endif %}">
            {% if '2026-01-25' in eventDates %}
              <a href="#date-2026-01-25" class="day-link"><span class="day-number">25</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">25</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-26' in eventDates %}has-events{% endif %}">
            {% if '2026-01-26' in eventDates %}
              <a href="#date-2026-01-26" class="day-link"><span class="day-number">26</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">26</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-27' in eventDates %}has-events{% endif %}">
            {% if '2026-01-27' in eventDates %}
              <a href="#date-2026-01-27" class="day-link"><span class="day-number">27</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">27</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-28' in eventDates %}has-events{% endif %}">
            {% if '2026-01-28' in eventDates %}
              <a href="#date-2026-01-28" class="day-link"><span class="day-number">28</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">28</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-29' in eventDates %}has-events{% endif %}">
            {% if '2026-01-29' in eventDates %}
              <a href="#date-2026-01-29" class="day-link"><span class="day-number">29</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">29</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-30' in eventDates %}has-events{% endif %}">
            {% if '2026-01-30' in eventDates %}
              <a href="#date-2026-01-30" class="day-link"><span class="day-number">30</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">30</span></span>
            {% endif %}
          </td>
          <td class="calendar-day {% if '2026-01-31' in eventDates %}has-events{% endif %}">
            {% if '2026-01-31' in eventDates %}
              <a href="#date-2026-01-31" class="day-link"><span class="day-number">31</span><span class="event-label">Event</span></a>
            {% else %}
              <span class="day-no-link"><span class="day-number">31</span></span>
            {% endif %}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

{# Date-grouped event list (mobile-first, also shows on desktop) #}
<div class="events-by-date">
  <h2 class="h4 mb-4">Upcoming Events by Date</h2>
  
  {% if datedEvents.length > 0 or recurringEvents.length > 0 %}
    {# Build a flat list of all events with their display dates #}
    {% set allEventsWithDates = [] %}
    
    {# Add dated events #}
    {% for event in datedEvents %}
      {% set allEventsWithDates = (allEventsWithDates.push({ date: event.date, event: event }), allEventsWithDates) %}
    {% endfor %}
    
    {# Add recurring events with their matching dates #}
    {% for recurring in recurringEvents %}
      {% set pattern = recurring.recurring_pattern | lower %}
      {% set matchingDates = [] %}
      
      {# Build list of dates this recurring event applies to #}
      {% if ("1st" in pattern or "first" in pattern) and "monday" in pattern %}
        {% set matchingDates = ["2026-01-05"] %}
      {% elif ("2nd" in pattern or "second" in pattern) and "monday" in pattern %}
        {% set matchingDates = ["2026-01-12"] %}
      {% elif ("3rd" in pattern or "third" in pattern) and "monday" in pattern %}
        {% set matchingDates = ["2026-01-19"] %}
      {% elif ("4th" in pattern or "fourth" in pattern) and "monday" in pattern %}
        {% set matchingDates = ["2026-01-26"] %}
      
      {% elif ("1st" in pattern or "first" in pattern) and "tuesday" in pattern %}
        {% set matchingDates = ["2026-01-06"] %}
      {% elif ("2nd" in pattern or "second" in pattern) and "tuesday" in pattern %}
        {% set matchingDates = ["2026-01-13"] %}
      {% elif ("3rd" in pattern or "third" in pattern) and "tuesday" in pattern %}
        {% set matchingDates = ["2026-01-20"] %}
      {% elif ("4th" in pattern or "fourth" in pattern) and "tuesday" in pattern %}
        {% set matchingDates = ["2026-01-27"] %}
      
      {% elif ("1st" in pattern or "first" in pattern) and "wednesday" in pattern %}
        {% set matchingDates = ["2026-01-07"] %}
      {% elif ("2nd" in pattern or "second" in pattern) and "wednesday" in pattern %}
        {% set matchingDates = ["2026-01-14"] %}
      {% elif ("3rd" in pattern or "third" in pattern) and "wednesday" in pattern %}
        {% set matchingDates = ["2026-01-21"] %}
      {% elif ("4th" in pattern or "fourth" in pattern) and "wednesday" in pattern %}
        {% set matchingDates = ["2026-01-28"] %}
      
      {% elif ("1st" in pattern or "first" in pattern) and "thursday" in pattern %}
        {% set matchingDates = ["2026-01-01"] %}
      {% elif ("2nd" in pattern or "second" in pattern) and "thursday" in pattern %}
        {% set matchingDates = ["2026-01-08"] %}
      {% elif ("3rd" in pattern or "third" in pattern) and "thursday" in pattern %}
        {% set matchingDates = ["2026-01-15"] %}
      {% elif ("4th" in pattern or "fourth" in pattern) and "thursday" in pattern %}
        {% set matchingDates = ["2026-01-22"] %}
      {% elif ("5th" in pattern or "fifth" in pattern) and "thursday" in pattern %}
        {% set matchingDates = ["2026-01-29"] %}
      
      {% elif ("1st" in pattern or "first" in pattern) and "friday" in pattern %}
        {% set matchingDates = ["2026-01-02"] %}
      {% elif ("2nd" in pattern or "second" in pattern) and "friday" in pattern %}
        {% set matchingDates = ["2026-01-09"] %}
      {% elif ("3rd" in pattern or "third" in pattern) and "friday" in pattern %}
        {% set matchingDates = ["2026-01-16"] %}
      {% elif ("4th" in pattern or "fourth" in pattern) and "friday" in pattern %}
        {% set matchingDates = ["2026-01-23"] %}
      {% elif ("5th" in pattern or "fifth" in pattern) and "friday" in pattern %}
        {% set matchingDates = ["2026-01-30"] %}
      
      {% elif ("1st" in pattern or "first" in pattern) and "saturday" in pattern %}
        {% set matchingDates = ["2026-01-03"] %}
      {% elif ("2nd" in pattern or "second" in pattern) and "saturday" in pattern %}
        {% set matchingDates = ["2026-01-10"] %}
      {% elif ("3rd" in pattern or "third" in pattern) and "saturday" in pattern %}
        {% set matchingDates = ["2026-01-17"] %}
      {% elif ("4th" in pattern or "fourth" in pattern) and "saturday" in pattern %}
        {% set matchingDates = ["2026-01-24"] %}
      {% elif ("5th" in pattern or "fifth" in pattern) and "saturday" in pattern %}
        {% set matchingDates = ["2026-01-31"] %}
      
      {% elif ("1st" in pattern or "first" in pattern) and "sunday" in pattern %}
        {% set matchingDates = ["2026-01-04"] %}
      {% elif ("2nd" in pattern or "second" in pattern) and "sunday" in pattern %}
        {% set matchingDates = ["2026-01-11"] %}
      {% elif ("3rd" in pattern or "third" in pattern) and "sunday" in pattern %}
        {% set matchingDates = ["2026-01-18"] %}
      {% elif ("4th" in pattern or "fourth" in pattern) and "sunday" in pattern %}
        {% set matchingDates = ["2026-01-25"] %}
      
      {% elif "monday" in pattern %}
        {% set matchingDates = ["2026-01-05", "2026-01-12", "2026-01-19", "2026-01-26"] %}
      {% elif "tuesday" in pattern %}
        {% set matchingDates = ["2026-01-06", "2026-01-13", "2026-01-20", "2026-01-27"] %}
      {% elif "wednesday" in pattern %}
        {% set matchingDates = ["2026-01-07", "2026-01-14", "2026-01-21", "2026-01-28"] %}
      {% elif "thursday" in pattern %}
        {% set matchingDates = ["2026-01-01", "2026-01-08", "2026-01-15", "2026-01-22", "2026-01-29"] %}
      {% elif "friday" in pattern %}
        {% set matchingDates = ["2026-01-02", "2026-01-09", "2026-01-16", "2026-01-23", "2026-01-30"] %}
      {% elif "saturday" in pattern %}
        {% set matchingDates = ["2026-01-03", "2026-01-10", "2026-01-17", "2026-01-24", "2026-01-31"] %}
      {% elif "sunday" in pattern %}
        {% set matchingDates = ["2026-01-04", "2026-01-11", "2026-01-18", "2026-01-25"] %}
      {% endif %}
      
      {# Add this recurring event for each matching date - only future dates #}
      {% for matchDate in matchingDates %}
        {% if matchDate >= today %}
          {% set allEventsWithDates = (allEventsWithDates.push({ date: matchDate, event: recurring }), allEventsWithDates) %}
        {% endif %}
      {% endfor %}
    {% endfor %}
    
    {# Sort by date #}
    {% set sortedEventsWithDates = allEventsWithDates | sort(false, false, 'date') %}
    
    {# Display events grouped by date #}
    {% set lastDate = '' %}
    {% for item in sortedEventsWithDates %}
      {% if item.date != lastDate %}
        {% if lastDate != '' %}</div>{% endif %}
        <div class="date-group" id="date-{{ item.date }}">
          <h3 class="date-header">
            {{ item.date | formatDate }}
          </h3>
        {% set lastDate = item.date %}
      {% endif %}
      
      {% set event = item.event %}
      <div class="event-card-compact">
        {% if event.image_url %}
          <div class="event-image">
            <img src="{{ event.image_url | eventImage }}" alt="{% if event.image_alt and event.image_alt | trim %}{{ event.image_alt }}{% endif %}">
          </div>
        {% endif %}
        <div class="event-content">
          <h4 class="event-title">{{ event.title }}</h4>
          {% if event.recurring_pattern %}
            <p class="recurring-pattern"><i class="fas fa-calendar-week" aria-hidden="true"></i> {{ event.recurring_pattern }}</p>
          {% endif %}
          <div class="event-meta">
            {% if event.time_start %}
              <span class="event-time">
                <i class="far fa-clock" aria-hidden="true"></i>
                {{ event.time_start }}{% if event.time_end and event.time_end | trim %} - {{ event.time_end }}{% endif %}
              </span>
            {% endif %}
            {% if event.price %}
              <span class="event-price">
                <i class="fas fa-ticket-alt" aria-hidden="true"></i>
                {{ event.price | formatPrice }}
              </span>
            {% endif %}
          </div>
          {% if event.description %}
            <p class="event-description">{{ event.description }}</p>
          {% endif %}
          {% if event.ticket_link or event.instagram_link %}
            <div class="event-actions">
              {% if event.ticket_link %}
                <a href="{{ event.ticket_link }}" class="hero-btn hero-btn-sm">
                  <i class="fas fa-ticket-alt" aria-hidden="true"></i> Tickets
                </a>
              {% endif %}
              {% if event.instagram_link %}
                <a href="{{ event.instagram_link }}" class="hero-btn hero-btn-sm">
                  <i class="fab fa-instagram" aria-hidden="true"></i> Instagram
                </a>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </div>
    {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">
      <p class="mb-0">No upcoming events. Check back soon!</p>
    </div>
  {% endif %}
</div>
